# Incoming Webhooks API Reference

LetterSpace's incoming webhook system allows you to receive real-time notifications about email delivery events from your SMTP provider. These are webhooks that your SMTP service (like SendGrid, Mailgun, Amazon SES, etc.) sends to LetterSpace to notify about email events.

> **Note**: These are incoming webhooks that LetterSpace receives from SMTP providers, not outgoing webhooks that LetterSpace sends to your application.

## Webhook Endpoint

Create webhooks in the LetterSpace dashboard to receive a unique URL that your SMTP provider will send events to.

```
POST /webhook/{webhookId}
```

Configure this URL in your SMTP provider's webhook settings to receive delivery events.

## Authentication

LetterSpace supports custom authentication for webhooks through JavaScript code. You can write your own authentication function that validates incoming webhook requests.

Your authentication function should be named `authorize` and return `true` for valid requests:

```javascript
function authorize(headers, body, query, params) {
  // Your custom authentication logic
  // Return true if the request is valid, false otherwise

  // Example: Check for a specific header
  if (headers["x-api-key"] === "your-secret-key") {
    return true
  }

  return false
}
```

The function receives:

- `headers`: Request headers object
- `body`: Request body (parsed JSON)
- `query`: Query parameters
- `params`: URL parameters

## Transform Function

Since different SMTP providers send webhook payloads in different formats, LetterSpace provides a transform function to normalize incoming payloads from various providers into a consistent format that LetterSpace can process.

Your transform function should be named `transform` and return an object with `messageId` and `event` fields:

```javascript
function transform(payload, headers, query) {
  // Transform the SMTP provider's webhook payload into LetterSpace format
  // Example for a hypothetical SMTP provider:

  return {
    messageId: payload.messageId, // Required: External message ID from SMTP provider
    event: payload.event, // Required: Event type (delivered, opened, clicked, etc.)
    timestamp: payload.timestamp, // Optional: Event timestamp
    error: payload.error, // Optional: Failure/bounce error message
  }
}
```

The function receives:

- `payload`: The raw webhook payload sent by your SMTP provider
- `headers`: HTTP request headers from the SMTP provider
- `query`: Query parameters from the webhook URL

### Required Fields

The transformed payload returned by your transform function must include:

- `messageId`: The external message ID provided by your SMTP provider
- `event`: The event type that occurred (see supported events below)

## Common SMTP Providers

This incoming webhook system works with popular SMTP providers including:

- **SendGrid**: Configure the webhook URL in your SendGrid Event Webhook settings
- **Mailgun**: Set up the webhook URL in your Mailgun webhook configuration
- **Amazon SES**: Configure SNS notifications to send to your webhook URL
- **Postmark**: Add the webhook URL to your Postmark webhook settings
- **Mailjet**: Configure the webhook URL in your Mailjet event tracking

Each provider sends webhook data in a different format, which is why the transform function is necessary to normalize the data.

### Webhook Events

<WebhookEventsReference />

### Response Codes

The webhook endpoint returns the following HTTP status codes:

- **200 OK**: Webhook processed successfully
- **400 Bad Request**: Missing webhook ID, required fields, or unknown event type
- **401 Unauthorized**: Authorization function returned false
- **404 Not Found**: Webhook not found, inactive, or message not found
- **500 Internal Server Error**: Authorization/transform code error or server error
