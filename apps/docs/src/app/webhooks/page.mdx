# Webhook API Reference

LetterSpace's webhook system allows you to receive real-time notifications about email delivery events from your SMTP provider.

## Webhook Endpoint

Create webhooks in the dashboard to receive a unique URL for your webhook endpoint.

```
POST /webhook/{webhookId}
```

## Authentication

LetterSpace supports custom authentication for webhooks through JavaScript code. You can write your own authentication function that validates incoming webhook requests.

Your authentication function should be named `authorize` and return `true` for valid requests:

```javascript
function authorize(headers, body, query, params) {
  // Your custom authentication logic
  // Return true if the request is valid, false otherwise

  // Example: Check for a specific header
  if (headers["x-api-key"] === "your-secret-key") {
    return true
  }

  return false
}
```

The function receives:

- `headers`: Request headers object
- `body`: Request body (parsed JSON)
- `query`: Query parameters
- `params`: URL parameters

## Transform Function

Since LetterSpace works with all SMTP providers, it provides a transform function to normalize payloads from different providers into a consistent format.

Your transform function should be named `transform` and return an object with `messageId` and `event` fields:

```javascript
function transform(payload, headers, query) {
  // Transform the provider-specific payload into LetterSpace format

  return {
    messageId: payload.messageId, // Required: External message ID
    event: payload.event, // Required: Event type
    timestamp: payload.timestamp, // Optional: Event timestamp
    reason: payload.reason, // Optional: Failure/bounce reason
  }
}
```

The function receives:

- `payload`: The raw webhook payload from your SMTP provider
- `headers`: Request headers
- `query`: Query parameters

### Required Fields

The transformed payload must include:

- `messageId`: The external message ID from your SMTP provider
- `event`: The event type (see supported events below)

### Webhook Events

<WebhookEventsReference />

### Response Codes

The webhook endpoint returns the following HTTP status codes:

- **200 OK**: Webhook processed successfully
- **400 Bad Request**: Missing webhook ID, required fields, or unknown event type
- **401 Unauthorized**: Authorization function returned false
- **404 Not Found**: Webhook not found, inactive, or message not found
- **500 Internal Server Error**: Authorization/transform code error or server error
